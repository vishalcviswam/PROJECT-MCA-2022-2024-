<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Course Material</title>
    <style>
        .material-fields { display: none; }
        .chapter-fields { display: none; }
    </style>
</head>
<body>

<!-- Course Material Form -->
<form method="post" action="" enctype="multipart/form-data">
    {% csrf_token %}
    <fieldset>
        <legend>Select Module:</legend>
        <label for="module_select">Module:</label>
        <select name="module_id" id="module_select" required onchange="loadChapters(this)">
            <option value="">--Select Module--</option>
            {% for module in modules %}
            <option value="{{ module.module_id }}">{{ module.module_name }}</option>
            {% endfor %}
        </select>
    </fieldset>

    <fieldset id="chapters_fieldset" style="display:none;">
        <!-- Chapters will be loaded here dynamically -->
    </fieldset>

    <input type="submit" value="Add Course Material">
</form>

<script>
    function showMaterialFields(select, chapterId) {
        // Hide all material field divs
        var fields = document.querySelectorAll(`.chapter_${chapterId} .material-fields`);
        fields.forEach(field => field.style.display = 'none');
    
        // Show the selected material field div
        if (select.value) {
            var selectedFields = document.querySelector(`#${select.value}_fields_${chapterId}`);
            if (selectedFields) {
                selectedFields.style.display = 'block';
            } else {
                console.error(`Fields for the selected material type ${select.value} not found.`);
            }
        }
    }
    

    function loadChapters(select) {
        var module_id = select.value;
        var chaptersFieldset = document.getElementById('chapters_fieldset');
        chaptersFieldset.style.display = module_id ? 'block' : 'none';
        var url = `/ajax/get_chapters_for_module/${module_id}/`;  // Ensure this URL is correct
    
        // Clear existing chapters
        chaptersFieldset.innerHTML = '';
    
        fetch(url, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(chapters => {
            chapters.forEach(chapter => {
                var chapterFieldset = document.createElement('fieldset');
                chapterFieldset.classList.add(`chapter_${chapter.chapter_id}`);
                chapterFieldset.innerHTML = `
                    <legend>${chapter.chapter_name}</legend>
                    <label>Select Material Type:</label>
                    <select name="material_type_${chapter.chapter_id}" onchange="showMaterialFields(this, '${chapter.chapter_id}')">
                        <option value="">--Select--</option>
                        <option value="reading">Reading Material</option>
                        <option value="video">Video Material</option>
                        <option value="multiple_choice">Multiple Choice Questions</option>
                        <!-- Add other material types as needed -->
                    </select>
                    <div id="reading_fields_${chapter.chapter_id}" class="material-fields">
                        <!-- Include fields for Reading Material -->
                        <label for="reading_title_${chapter.chapter_id}">Title:</label>
                        <input type="text" id="reading_title_${chapter.chapter_id}" name="reading_title_${chapter.chapter_id}" placeholder="Title">
                        <label for="reading_text_content_${chapter.chapter_id}">Text Content:</label>
                        <textarea id="reading_text_content_${chapter.chapter_id}" name="reading_text_content_${chapter.chapter_id}" placeholder="Text content"></textarea>
                        <label for="reading_images_${chapter.chapter_id}">Images:</label>
                        <input type="file" id="reading_images_${chapter.chapter_id}" name="reading_images_${chapter.chapter_id}" accept="image/*">
                    </div>
                    
                    <div id="video_fields_${chapter.chapter_id}" class="material-fields">
                        <!-- Include fields for Video Material -->
                        <label for="video_video_${chapter.chapter_id}">Video:</label>
                        <input type="file" id="video_video_${chapter.chapter_id}" name="video_video_${chapter.chapter_id}" accept="video/*">
                        <label for="video_transcript_${chapter.chapter_id}">Transcript:</label>
                        <textarea id="video_transcript_${chapter.chapter_id}" name="video_transcript_${chapter.chapter_id}" placeholder="Video transcript"></textarea>
                    </div>
                    
                    <div id="multiple_choice_fields_${chapter.chapter_id}" class="material-fields">
                        <!-- Fields for Multiple Choice Question Material -->
                        <label for="mc_question_text_${chapter.chapter_id}">Question Text:</label>
                        <textarea id="mc_question_text_${chapter.chapter_id}" name="mc_question_text_${chapter.chapter_id}" placeholder="Enter the question"></textarea>
                        
                        <label for="mc_choice_1_${chapter.chapter_id}">Choice 1:</label>
                        <input type="text" id="mc_choice_1_${chapter.chapter_id}" name="mc_choice_1_${chapter.chapter_id}" placeholder="Choice 1">
                        
                        <label for="mc_choice_2_${chapter.chapter_id}">Choice 2:</label>
                        <input type="text" id="mc_choice_2_${chapter.chapter_id}" name="mc_choice_2_${chapter.chapter_id}" placeholder="Choice 2">
                        
                        <label for="mc_choice_3_${chapter.chapter_id}">Choice 3:</label>
                        <input type="text" id="mc_choice_3_${chapter.chapter_id}" name="mc_choice_3_${chapter.chapter_id}" placeholder="Choice 3">
                        
                        <label for="mc_choice_4_${chapter.chapter_id}">Choice 4:</label>
                        <input type="text" id="mc_choice_4_${chapter.chapter_id}" name="mc_choice_4_${chapter.chapter_id}" placeholder="Choice 4">
                        
                        <label for="mc_correct_answer_${chapter.chapter_id}">Correct Answer:</label>
                        <input type="text" id="mc_correct_answer_${chapter.chapter_id}" name="mc_correct_answer_${chapter.chapter_id}" placeholder="Enter the correct answer exactly as one of the choices">
                    </div>
                    
                    <!-- Include other material divs as needed, with chapter ID appended to the name attributes -->
                `;
                chaptersFieldset.appendChild(chapterFieldset);
            });
        })
        .catch(error => {
            console.error('There has been a problem with your fetch operation:', error);
        });
    }
</script>

</body>
</html>
